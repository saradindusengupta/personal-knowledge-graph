# Docker Compose override for Production
# Usage: docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

services:
  neo4j:
    # Use enterprise edition for production
    image: neo4j:enterprise-ubi9
    
    restart: always
    
    environment:
      # Production-specific settings
      - NEO4J_dbms_logs_debug_level=INFO
      - NEO4J_dbms_logs_query_enabled=INFO
      - NEO4J_dbms_logs_query_threshold=10s
      - NEO4J_dbms_logs_query_parameter__logging__enabled=false
      - NEO4J_ACCEPT_LICENSE_AGREEMENT=yes
      
      # Enhanced security
      - NEO4J_dbms_security_auth__minimum__password__length=12
      - NEO4J_dbms_security_allow__csv__import__from__file__urls=false
      
    # Full resource allocation
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
      
      # Production restart policy
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
    
    # Production volumes only (no source code mounts)
    volumes:
      - neo4j_data:/data
      - neo4j_logs:/logs
      - neo4j_import:/import
      - neo4j_metrics:/metrics
      - neo4j_plugins:/plugins
      # Uncomment for custom config
      # - ./config/neo4j.conf:/var/lib/neo4j/conf/neo4j.conf:ro
      # Uncomment for SSL certificates
      # - ./config/ssl:/var/lib/neo4j/certificates:ro
